# **스마트 수면 환경 관리 IoT 시스템 – 최종 프로젝트 결과 보고서**

---

## **1. 프로젝트 개요**

### **1.1 프로젝트명**

**Smart Sleep Environment Management IoT System**

### **1.2 프로젝트 목적**

현대인의 수면 질을 결정하는 핵심 요소 중 하나는 **환경 조절(온도, 조도)**이다. 본 프로젝트는 IoT 기술을 활용하여 사용자의 수면 공간 환경을 실시간으로 측정하고, 스마트폰을 통해 편리하게 모니터링하며, 타이머 기반으로 기상 알람(LED 및 부저)을 제공하는 **스마트 수면 관리 시스템**을 구현하는 것을 목표로 한다.

특히, 아두이노(센서/액추에이터), 프로세싱(웹 서버/브릿지), 앱 인벤터(모바일 UI)를 통합하여 **저비용·고효율 IoT 구조**를 직접 설계하고 구축한 데 의의가 있다.

---

## **2. 시스템 구성 및 아키텍처**

### **2.1 전체 시스템 구조**

본 시스템은 아래와 같은 3단계 구조로 동작한다.

```
[Arduino] ⇄(Serial)⇄ [Processing Server] ⇄(HTTP/WiFi)⇄ [App Inventor App]
```

### **2.2 역할 요약**

| 구성 요소            | 역할            | 상세 기능                         |
| ---------------- | ------------- | ----------------------------- |
| **Arduino**      | 센서 수집 + 알람 제어 | 온도/조도 측정, 타이머, 부저·LED 제어      |
| **Processing**   | 웹 서버 + 데이터 중계 | HTTP 서버, 아두이노 ↔ 앱 통신 브릿지      |
| **App Inventor** | 사용자 UI        | 실시간 표시, 타이머 설정, START/STOP 전송 |

---

## **3. 하드웨어 설계**

### **3.1 센서 및 회로 구성**

* **온도 센서(NTC 10k)**: Steinhart–Hart 기반 온도 계산
* **조도 센서(LDR)**: 0~1023 아날로그 값으로 밝기 수집
* **LED**: 타이머 종료 시 점등
* **피에조 부저**: 알람음 재생(1kHz tone)

### **3.2 설계 고려사항**

* 센서의 값이 0일 때(단선 상태) 연산 오류를 피하기 위해 보호 코드 작성
* 타이머 동작 동안에도 센서가 정상적으로 갱신되도록 `millis()` 기반 비차단 방식 적용

---

## **4. 소프트웨어 구현 상세 분석**

# **4.1 Arduino 펌웨어**

### **(1) 센서 데이터 계산**

* 온도 계산: NTC B-계수 공식 사용 → 정확한 실내 온도 제공
* 조도 값: 실시간 밝기 상태(어두움/밝음) 판별 가능

### **(2) 데이터 전송 형식 개선**

**초기 계획:** `T:xx,L:yy`

→ App Inventor 파싱 문제 발생

**최종 구현:** `25.60,420` (CSV 형식)

→ 앱에서 `split at “,”`로 간단히 처리 가능 → 신뢰성 상승

### **(3) 명령어 처리**

| 명령           | 동작                    |
| ------------ | --------------------- |
| `START:5000` | 5초 타이머 시작, LED·부저 초기화 |
| `STOP`       | 타이머 및 알람 즉시 중지        |

### **(4) 타이머 동작 개선**

* 기존 블로킹 방식인 `delay()`를 사용하지 않음
* `millis()` 기반 → 센서 측정·명령 수신·알람 제어가 동시에 작동하는 **멀티태스킹 구조 실현**

---

# **4.2 Processing (PC 서버)**

Processing은 단순한 시리얼 모니터가 아닌, **실제 웹 서버** 역할을 수행하도록 설계됨.

### **(1) 아두이노 → 데이터 수신**

아두이노가 보내는 `25.50,512` 형식의 값을 그대로 저장 → App Inventor 응답에 사용

### **(2) App Inventor → 명령 수신**

프로세싱은 HTTP 요청을 분석하여 다음과 같이 처리한다:

* `GET /sensor` → 최신 센서 데이터 반환
* `GET /cmd?v=START:5000` → 아두이노로 시리얼 전송

### **(3) 문자열 파싱 개선**

프로세싱에서 오는 문자열 끝에 붙는 `
` 또는 공백 때문에 아두이노에서 명령이 인식되지 않는 문제 발생 → 해결:

```cpp
cmd.trim();    // 불필요한 제어 문자 제거
```

이 한 줄로 통신 안정성이 대폭 향상됨.

---

# **4.3 App Inventor 앱 구현**

### **(1) UI 구성 요소**

* 온도 표시 라벨
* 조도 표시 라벨
* 타이머 입력 박스(밀리초)
* “타이머 시작”, “타이머 정지” 버튼

### **(2) /sensor 주기적 요청**

Clock1.Timer → `/sensor` 요청 → 응답 처리

### **(3) 응답 파싱 구조**

**응답:** `25.41,422`

* split at ","
* index1 = 온도
* index2 = 조도
* 각각 Label_temp, Label_light에 표시

### **(4) 명령 전송 구조**

| 버튼     | 요청                 | 동작           |
| ------ | ------------------ | ------------ |
| 타이머 시작 | `/cmd?v=START:입력값` | 타이머 시작 명령 송신 |
| 타이머 정지 | `/cmd?v=STOP`      | LED/부저 즉시 정지 |

---

# **5. 통신 프로토콜 종합표**

| 구간                   | 방향            | 프로토콜          | 데이터 예시       |
| -------------------- | ------------- | ------------- | ------------ |
| Arduino → Processing | 센서 데이터        | Serial        | `24.85,481`  |
| Processing → Arduino | 제어 명령         | Serial        | `START:7000` |
| App → Processing     | HTTP GET      | `/sensor`     | 실시간 요청       |
| App → Processing     | HTTP GET      | `/cmd?v=STOP` | 명령 전달        |
| Processing → App     | HTTP Response | Text          | `25.22,600`  |

---

# **6. 문제 해결 및 기술적 고찰**

본 프로젝트에서 가장 중요한 학습 포인트는 **통신 안정성 확보**였다.

### **6.1 문제 1 — App Inventor 파싱 오류**

**원인:** 문자열 형식이 너무 복잡함 (`T:xx,L:xx`)

**해결:** 단순 CSV로 변경 → 모든 플랫폼에서 파싱 성공

---

### **6.2 문제 2 — 명령어 인식 실패**

**원인:** 시리얼에서 넘어오는 숨겨진 제어문자(`
`)

**해결:** `trim()` 추가 → 명령 인식률 100% 달성

---

### **6.3 문제 3 — 타이머 동안 센서 멈춤**

**원인:** delay 기반 블로킹 구조

**해결:** `millis()` 기반 논블로킹 방식

→ 타이머·센싱·명령수신이 동시에 이루어지는 구조로 개선

---

# **7. 최종 구현 결과**

### **7.1 구현 완료 기능**

* 실시간 온도·조도 모니터링
* 스마트폰 앱과 아두이노 간 양방향 통신 성공
* 타이머 기반 알람 정상 동작
* START/STOP 명령 완벽 동작
* 전체 시스템 안정적으로 연동

### **7.2 시연 결과 요약**

* 센서 값이 앱 라벨에 0.2초 간격으로 정상 업데이트
* 타이머 입력 후 “타이머 시작” 버튼 → 지정 시간 후 LED·부저 작동
* “타이머 정지” 버튼 → 즉시 종료

---

# **8. 결론 및 향후 발전 방안**

### **8.1 결론**

본 프로젝트는 IoT 기술의 본질인 **실시간 데이터 수집 → 네트워크 전송 → 사용자 응답 제어**의 전 과정을 직접 설계하고 구현했다는 점에서 교육적 가치가 매우 크다.

특히 아두이노·Processing·App Inventor를 하나의 생태계로 묶어 **저비용 IoT 시스템을 실제로 완성**했다는 점에서 높은 완성도를 가진 프로젝트다.

### **8.2 향후 발전 방향**

* ESP32 기반 Wi-Fi 직접 연결 구조로 업그레이드 (Processing 제거 가능)
* 앱에 수면 패턴 기록 기능 추가 (DB 연동)
* 온도/조도에 따른 자동 제어(자동 조명/환풍기)
* 외부 접속을 위한 MQTT 기반 IoT 서버 구성

---
